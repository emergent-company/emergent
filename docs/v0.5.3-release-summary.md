# v0.5.3 Release - Docker CLI Build Fix Summary

## Problem

The `emergent-server-with-cli` Docker image fails to build because the SDK `COPY` destination path in the Dockerfile causes `go build` to fail with:

```
replacement directory ../../apps/server-go/pkg/sdk does not exist
```

## Root Cause

The CLI's `go.mod` has a replace directive:

```
replace github.com/emergent-company/emergent/apps/server-go/pkg/sdk => ../../apps/server-go/pkg/sdk
```

With `WORKDIR /build/cli`, this resolves to `/apps/server-go/pkg/sdk` (two dirs up from `/build/cli` → `/`).

Previous attempts copied the SDK to wrong locations:

- **Attempt 1** (`e1b5473`): `COPY apps/server-go/pkg/sdk/ ../apps/server-go/pkg/sdk/` → resolved to `/build/apps/...` ❌
- **Attempt 2** (`53f928f`): `COPY apps/server-go/pkg/sdk/ ../../apps/server-go/pkg/sdk/` → Docker COPY restriction ❌

## Fix

Changed line 42 of `deploy/minimal/Dockerfile.server-with-cli` to use an absolute destination path:

```dockerfile
COPY apps/server-go/pkg/sdk/ /apps/server-go/pkg/sdk/
```

This places the SDK exactly where `go.mod`'s replace directive resolves to.

## Path Math

```
Docker WORKDIR:       /build/cli
go.mod location:      /build/cli/go.mod
Replace directive:    ../../apps/server-go/pkg/sdk
Resolves to:          /apps/server-go/pkg/sdk    (two dirs up from /build/cli → /)

Attempt 1 dst:        ../apps/server-go/pkg/sdk  → /build/apps/server-go/pkg/sdk  ❌
Attempt 2 dst:        ../../apps/server-go/pkg/sdk → Docker COPY restriction       ❌
Fix dst:              /apps/server-go/pkg/sdk     → /apps/server-go/pkg/sdk        ✅
```

## Status

- [x] Fix applied to disk (uncommitted)
- [ ] Local Docker build verified
- [ ] Committed (Dockerfile only)
- [ ] Tag v0.5.3 moved and pushed
- [ ] CI passes
- [ ] Image published to GHCR

## Remaining Steps

1. Run local Docker build: `docker build -f deploy/minimal/Dockerfile.server-with-cli -t test-cli-build .`
2. Commit: `git add deploy/minimal/Dockerfile.server-with-cli && git commit -m "fix(docker): use absolute path for SDK COPY destination in CLI builder"`
3. Move tag: `git tag -d v0.5.3 && git push origin :refs/tags/v0.5.3 && git tag -a v0.5.3 -m "Release v0.5.3"`
4. Push: `git push origin main v0.5.3`
5. Monitor CI: `gh run list --repo emergent-company/emergent --limit 5`
6. Verify image: `ghcr.io/emergent-company/emergent-server-with-cli:0.5.3`
